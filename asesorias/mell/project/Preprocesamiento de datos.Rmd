---
title: "Preprocesamiento de datos"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Carga de bibliotecas
library(readr)
library(readxl)
library(dplyr)
library(skimr)
library(naniar)
library(VIM) #KNN
library(ggplot2)
```

# Introducción

Agroindustria Hiui desea mejorar su gestión de inventarios. Para lo cual desea realizar una clasificación ABC multicriterio, cuya base de ponderación serán los pesos de procesos de jerarquía analítica.

No obstante, para poder realizar un proyecto de mejora en los inventarios, es fundamental analizar el comportamiento de los datos, además de validar que los datos sean de calidad para su procesamiento.

El gerente de TI le brinda la base de datos, “data_inventory.csv”, que presenta en su diseño 7 atributos y contiene 133361 registros de SKUs.

✓ Numero_SKU: identificador del tipo de producto.  
✓ Tipo_archivo: indica si el registro es histórico, Historical, o si el producto esta presente en el almacén, Active.  
✓ Tipo_marketing: la empresa posee dos tipos de promoción de ventas para incrementar la rotación de inventario; tipo D y tipo S.  
✓ Demanda: se registra la demanda estimada del SKU durante el 2022 (unidades de producto).  
✓ Precio: Precio en soles por unidad del $Producto_i$ del tipo del $SKU_i$.  
✓ Lead_time: tiempo promedio expresados en días que Agroindustrias Hiu demora en abastecerse de los $Productos_i$ pertenecientes al $SKU_i$.  
✓ Estabilidad_suministro: Dificultad de abastecimiento del $Producto_i$ del tipo del $SKU_i$. durante nuestro escenario postpandemia.

# Carga de datos
```{r}
data_inventory <- 
  read_csv(file = "data_inventory.csv",
           show_col_types = F)

data_inventory %>% glimpse()
```

# Análisis de datos faltantes

Al revisar los datos usted inmediatamente se percata que aun no esta limpia la base de datos, por lo cual se le solicita realizar un informe con los siguientes puntos claves:

## a) Analice la proporción de datos faltantes por tipo de atributo. Realice comentarios acerca de esta problemática.
```{r}
data_inventory %>% 
  skim() %>% 
  select(skim_variable, n_missing, complete_rate) %>% 
  mutate(incomplete_rate = round((1 - complete_rate) * 100, 2)) %>% 
  arrange(-incomplete_rate) %>% 
  select(-complete_rate)
```

El atributo precio presenta un 2.07 % de datos faltantes, mientras que la estabilidad de suministro presenta 2.03 % y por ultimo el lead time, presenta un 2.02 %.

## b) Inputar los datos faltantes por métodos univariables y métodos multivariables. Explique las ventajas y desventajas de cada método aplicada a la data de inventarios.

Usualmente cuando el porcentaje de datos faltantes no es alto, como regla menor a 1 %, se puede prescindir de los mismos, a pesar de que se reconoce que esta práctica no es la más apropiada, ya que genera sesgos en los coeficientes de asociación y de correlación (Kalton y Kasprzyk, 1982).

### Imputación por la media
```{r}
data_inventory_media <- 
  data_inventory %>% 
  impute_mean_at(.vars = c("Precio", "Estabilidad_suministro", "Lead_time"))
```

### Imputación por la mediana
```{r}
data_inventory_mediana <- 
  data_inventory %>% 
  impute_median_at(.vars = c("Precio", "Estabilidad_suministro", "Lead_time"))
```

## c) Realizar el análisis de outliers por métodos univariables y métodos multivariables. Explique las ventajas y desventajas de cada método aplicada a la data de inventarios.

### Análisis por el diagrama de cajas
```{r}
data_inventory_media %>% 
  ggplot(mapping = aes(y = Demanda)) + 
  geom_boxplot()

data_inventory_media %>% 
  ggplot(mapping = aes(y = Precio)) + 
  geom_boxplot()

data_inventory_media %>% 
  ggplot(mapping = aes(y = Lead_time)) + 
  geom_boxplot()

data_inventory_media %>% 
  ggplot(mapping = aes(y = Estabilidad_suministro)) + 
  geom_boxplot()
```

## d) Realizar un análisis descriptivo de cada variable de la base preprocesada. Interprete.
### Atributo Lead Time
```{r}
data_inventory_media %>% 
  group_by(Tipo_marketing, Tipo_archivo) %>% 
  summarise(min = min(Lead_time),
            p25 = quantile(Lead_time, probs = 0.25),
            media = round(mean(Lead_time), 2),
            mediana = median(Lead_time),
            p75 = quantile(Lead_time, probs = 0.75),
            max = max(Lead_time),
            sd = round(sd(Lead_time), 2))
```

- El Lead Time mínimo de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento mínimo de 4 días, esta estadística se repite para todos los productos activos o históricos según cada tipo de marketing.

- El 25% de los productos tiene un Lead Time de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento a lo más 6 días, esta estadística se repite para todos los productos activos o históricos según cada tipo de marketing.

- El Lead Time promedio de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento 7.98 días. Por otro lado, los productos históricos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento 8.01 días. Esta misma estadística se repite para los productos activos ofertados por el marketing S. Por otro lado, los productos históricos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento 8.02 días.

- La mediana de los productos tiene un Lead Time de productos activos ofertados por el marketing D, presentan una mediana de tiempo de abastecimiento de 8 días, esta estadística se repite para todos los productos activos o históricos según cada tipo de marketing.

- El 75% de los productos tiene un Lead Time de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento a lo más 10 días, esta estadística se repite para todos los productos activos o históricos según cada tipo de marketing.

- El Lead Time máximo de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento máximo de 12 días, esta estadística se repite para todos los productos activos o históricos según cada tipo de marketing.

### Atributo Demanda
```{r}
data_inventory_media %>% 
  group_by(Tipo_marketing, Tipo_archivo) %>% 
  summarise(min = min(Demanda),
            p25 = quantile(Demanda, probs = 0.25),
            media = round(mean(Demanda), 2),
            mediana = median(Demanda),
            p75 = quantile(Demanda, probs = 0.75),
            max = max(Demanda),
            sd = round(sd(Demanda), 2))
```

- La demanda mínima de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento de 2,517.457 unidades, siendo la mas alta registrada. Por otro lado, la demanda mínima de productos activos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento mínimo de 6.275 unidades, siendo esta la mas baja.

- El 25% de los productos tienen una demanda de productos activos ofertados por el marketing D, presentan una demanda 916,390.10 unidades, siendo esta la mas alta registrada. Por otro lado, el 25% de los productos tienen una demanda de productos activos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento mínimo de 52,927.65 unidades, siendo esta la mas baja.

- La demanda media de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento mínimo de 2,376,512.4 unidades, siendo la mas alta registrada. Por otro lado, la demanda media de productos activos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento mínimo de 229,926.8 unidades, siendo esta la mas baja.

- La mediana de la demanda de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento mínimo de 1,818,957.0 unidades, siendo la mas alta registrada. Por otro lado, la mediana de la demanda de productos activos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento mínimo de 113,754.1 unidades, siendo esta la mas baja.

- El 75% de los productos tienen una demanda de productos activos ofertados por el marketing D, presentan una demanda 3,141,345.0 unidades, siendo esta la mas alta registrada. Por otro lado, el 75% de los productos tienen una demanda de productos activos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento mínimo de 307,478.5 unidades, siendo esta la mas baja.

- La demanda máxima de productos activos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento de 17,384,454 unidades, siendo la mas alta registrada. Por otro lado, la demanda máxima de productos históricos ofertados por el marketing S, presentan un tiempo promedio de abastecimiento mínimo de 15,318,509 unidades, siendo esta la mas baja.

### Atributo Precio
```{r}
data_inventory_media %>% 
  group_by(Tipo_marketing, Tipo_archivo) %>% 
  summarise(min = min(Precio),
            p25 = quantile(Precio, probs = 0.25),
            media = round(mean(Precio), 2),
            mediana = median(Precio),
            p75 = quantile(Precio, probs = 0.75),
            max = max(Precio),
            sd = round(sd(Precio), 2))
```

- El precio mínimo de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento de 20 unidades, siendo esta la misma para el resto de productos.

- El 25% de los productos tienen un precio de productos activos ofertados por el marketing S, presentan una demanda 66.1 unidades, siendo esta la mas alta registrada. Por otro lado, el 25% de los productos tienen una demanda de productos activos ofertados por el marketing D, presentan un tiempo promedio de abastecimiento mínimo de 65.4 unidades, siendo esta la mas baja.

- El precio medio de productos histórico ofertados por el marketing S, presentan un tiempo promedio de abastecimiento de 110.04 unidades, siendo la mas alta registrada. Por otro lado, el precio medio de productos activos ofertados por el marketing D, presentan un precio promedio de abastecimiento de 109.66 unidades, siendo esta la mas baja.

## e) Después de una semana que usted realiza el análisis de datos faltantes, le brindan la data que se recuperó del sistema, data_completa. ¿su imputación fue de calidad? Sustente.
```{r}
data_completa <- 
  read_excel(path = "data_completa.xlsx")

precio_na <- 
  data_inventory %>% 
  filter(is.na(Precio)) %>% 
  select(Numero_SKU) %>% 
  as.vector()

data_completa_precio <- 
  data_completa %>% 
  select(Numero_SKU, Precio) %>% 
  filter(Numero_SKU %in% precio_na$Numero_SKU)

data_error <- 
  data_completa_precio %>% 
  left_join(data_inventory_media, by = c("Numero_SKU" = "Numero_SKU"))

data_error <- 
  data_error %>% 
  mutate(dif = Precio.x - Precio.y)

summary(data_error$dif)
```
















